# ุฏููู ุงูุฅุดุนุงุฑุงุช ูู ุงูููุช ุงููุนูู

## ุงููุดููุฉ ุงูุณุงุจูุฉ

ุงูุฅุดุนุงุฑุงุช ูุงูุช ุชุธูุฑ ูู ุงูููุช ุงููุนูู ุนูู Google Chromeุ ููู ุตูุญุฉ ุงูุฅุดุนุงุฑุงุช ูุงููุงูุจุงุฑ ูุง ูุชู ุชุญุฏูุซูุง ุชููุงุฆูุงู. ูุงู ุงููุณุชุฎุฏู ูุญุชุงุฌ ูุนูู refresh ูุฑุคูุฉ ุงูุฅุดุนุงุฑุงุช ุงูุฌุฏูุฏุฉ.

## ุงูุญู ุงููุทุจู

### 1. ุชุญุณูู NotificationContext

ุชู ุชุญุณูู `src/context/NotificationContext.jsx` ูุฅุถุงูุฉ:

- **Firebase Messaging Listener**: ุงุณุชูุงุน ููุฅุดุนุงุฑุงุช ูู ุงูููุฏูุฉ (foreground)
- **Service Worker Message Listener**: ุงุณุชูุงุน ููุฅุดุนุงุฑุงุช ูู Service Worker
- **ุฅุถุงูุฉ ุชููุงุฆูุฉ ููุฅุดุนุงุฑุงุช ุงูุฌุฏูุฏุฉ**: ุฅุถุงูุฉ ุงูุฅุดุนุงุฑุงุช ุงูุฌุฏูุฏุฉ ูููุงุฆูุฉ ููุฑุงู

### 2. ุชุญุณูู Service Worker

ุชู ุชุญุณูู `public/firebase-messaging-sw.js` ูุฅุถุงูุฉ:

- **ุฅุฑุณุงู ุงูุจูุงูุงุช ุงููุงููุฉ**: ุฅุฑุณุงู ุฌููุน ุจูุงูุงุช ุงูุฅุดุนุงุฑุงุช ููุชุทุจูู
- **ุฑุณุงุฆู ููุนููุงุก**: ุฅุฑุณุงู ุฑุณุงุฆู ูุฌููุน ุงูุชุจููุจุงุช ุงูููุชูุญุฉ
- **ุชุญุณูู ุงูููุฑ ุนูู ุงูุฅุดุนุงุฑุงุช**: ูุชุญ ุงูุชุจููุจ ุงูููุฌูุฏ ุจุฏูุงู ูู ุฅูุดุงุก ุชุจููุจ ุฌุฏูุฏ

### 3. ุชุญุณูู ุตูุญุฉ ุงูุฅุดุนุงุฑุงุช

ุชู ุชุญุณูู `src/pages/Notifications/Notifications.jsx` ูุฅุถุงูุฉ:

- **ุชุญุฏูุซ ุชููุงุฆู**: ุชุญุฏูุซ ุงูุฅุดุนุงุฑุงุช ูู 30 ุซุงููุฉ
- **ุงุณุชูุงุน ููุชุบููุฑุงุช**: ุชุญุฏูุซ ุงููุงุฆูุฉ ุนูุฏ ูุตูู ุฅุดุนุงุฑุงุช ุฌุฏูุฏุฉ

## ููููุฉ ุงูุนูู

### 1. ุงูุฅุดุนุงุฑุงุช ูู ุงูููุฏูุฉ (Foreground)

```javascript
// ูู NotificationContext.jsx
const unsubscribe = onMessage(messaging, (payload) => {
  console.log("๐จ ุฅุดุนุงุฑ ุฌุฏูุฏ ูู ุงูููุฏูุฉ:", payload);

  const notificationData = payload.data || {};
  const notification = {
    id: notificationData.id || Date.now(),
    service_name: notificationData.service_name || "Service",
    status: notificationData.status || "info",
    // ... ุจุงูู ุงูุจูุงูุงุช
  };

  addNotification(notification);
});
```

### 2. ุงูุฅุดุนุงุฑุงุช ูู ุงูุฎูููุฉ (Background)

```javascript
// ูู firebase-messaging-sw.js
messaging.onBackgroundMessage((payload) => {
  // ุฅุธูุงุฑ ุงูุฅุดุนุงุฑ
  self.registration.showNotification(title, {
    body,
    icon,
    data: {
      click_action,
      ...payload.data, // ุฅุฑุณุงู ุฌููุน ุงูุจูุงูุงุช
    },
  });

  // ุฅุฑุณุงู ุฑุณุงูุฉ ูุฌููุน ุงูุชุจููุจุงุช
  self.clients.matchAll().then((clients) => {
    clients.forEach((client) => {
      client.postMessage({
        type: "NEW_NOTIFICATION",
        payload: payload,
      });
    });
  });
});
```

### 3. ุงุณุชูุจุงู ุงูุฑุณุงุฆู ูู Service Worker

```javascript
// ูู NotificationContext.jsx
const handleServiceWorkerMessage = (event) => {
  if (event.data && event.data.type === "NEW_NOTIFICATION") {
    console.log("๐จ ุฅุดุนุงุฑ ุฌุฏูุฏ ูู Service Worker:", event.data.payload);

    const payload = event.data.payload;
    const notificationData = payload.data || {};
    const notification = {
      // ... ุฅูุดุงุก ูุงุฆู ุงูุฅุดุนุงุฑ
    };

    addNotification(notification);
  }
};
```

## ุงููุชุงุฆุฌ

### โ **ูุจู ุงูุชุญุณูู:**

- ุงูุฅุดุนุงุฑุงุช ุชุธูุฑ ูู ุงูููุช ุงููุนูู
- ุตูุญุฉ ุงูุฅุดุนุงุฑุงุช ุชุญุชุงุฌ refresh
- ุงููุงูุจุงุฑ ูุง ูุชู ุชุญุฏูุซู ุชููุงุฆูุงู

### โ **ุจุนุฏ ุงูุชุญุณูู:**

- ุงูุฅุดุนุงุฑุงุช ุชุธูุฑ ูู ุงูููุช ุงููุนูู
- ุตูุญุฉ ุงูุฅุดุนุงุฑุงุช ุชุชุญุฏุซ ุชููุงุฆูุงู
- ุงููุงูุจุงุฑ ูุชุญุฏุซ ุชููุงุฆูุงู
- ุนุฏุงุฏ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ ูุชุญุฏุซ ููุฑุงู
- ุชุญุฏูุซ ุชููุงุฆู ูู 30 ุซุงููุฉ ููุณุฎุฉ ุงุญุชูุงุทูุฉ

## Debugging

ุงูุชุญ Developer Tools (F12) ูุงูุชูู ุฅูู Console ูุฑุคูุฉ:

```
๐จ ุฅุดุนุงุฑ ุฌุฏูุฏ ูู ุงูููุฏูุฉ: {notification: {...}, data: {...}}
๐จ ุฅุดุนุงุฑ ุฌุฏูุฏ ูู Service Worker: {notification: {...}, data: {...}}
โ ุฅุถุงูุฉ ุฅุดุนุงุฑ ุฌุฏูุฏ: {id: 123, service_name: "Service", ...}
```

## ููุงุญุธุงุช ูููุฉ

1. **ุงูุฅุดุนุงุฑุงุช ูู ุงูููุฏูุฉ**: ุชุนูู ุนูุฏูุง ูููู ุงูุชุทุจูู ููุชูุญ
2. **ุงูุฅุดุนุงุฑุงุช ูู ุงูุฎูููุฉ**: ุชุนูู ุนูุฏูุง ูููู ุงูุชุทุจูู ูุบูู
3. **ุงูุชุญุฏูุซ ุงูุชููุงุฆู**: ูู 30 ุซุงููุฉ ููุณุฎุฉ ุงุญุชูุงุทูุฉ
4. **ุงูุจูุงูุงุช ุงููุงููุฉ**: ุฌููุน ุจูุงูุงุช ุงูุฅุดุนุงุฑุงุช ูุชู ุฅุฑุณุงููุง
5. **ุงูุชูุงูู**: ูุนูู ูุน ุฌููุน ุงููุชุตูุญุงุช ุงููุฏุนููุฉ

## ุงูุชุญูู ูู ุงููุฌุงุญ

1. ุงูุชุญ ุตูุญุฉ ุงูุฅุดุนุงุฑุงุช
2. ุงูุชุธุฑ ูุตูู ุฅุดุนุงุฑ ุฌุฏูุฏ
3. ุณุชุฌุฏ ุฃู:
   - ุงูุฅุดุนุงุฑ ูุธูุฑ ูู ุงููุงุฆูุฉ ููุฑุงู
   - ุนุฏุงุฏ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ ูุชุญุฏุซ
   - ุงููุงูุจุงุฑ ูุชุญุฏุซ ุชููุงุฆูุงู
   - ูุง ุญุงุฌุฉ ูู refresh

## ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

โ **ุงูุฅุดุนุงุฑุงุช ูู ุงูููุช ุงููุนูู**  
โ **ุชุญุฏูุซ ุชููุงุฆู ููุตูุญุงุช**  
โ **ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู**  
โ **ุฏุนู ุงูุฅุดุนุงุฑุงุช ูู ุงูููุฏูุฉ ูุงูุฎูููุฉ**  
โ **ุชุญุฏูุซ ุนุฏุงุฏ ุงูุฅุดุนุงุฑุงุช ููุฑุงู**
